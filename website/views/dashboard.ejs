<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/style.css">
</head>
<body style="overflow: hidden;"> <!-- Prevent body scroll for admin layout -->
    <div class="admin-layout">
        <!-- Professional Admin Sidebar -->
        <aside class="admin-sidebar slide-in-left">
            <div class="mb-5 px-2">
                <h3 class="fw-bold m-0 text-white">Admin<span style="color: var(--primary-light)">Panel</span></h3>
            </div>
            
            <nav class="flex-grow-1">
                <a href="/dashboard" class="admin-nav-item active">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
                <a href="/add-note" class="admin-nav-item">
                    <i class="bi bi-plus-circle"></i> Add Note
                </a>
                <a href="/" target="_blank" class="admin-nav-item">
                    <i class="bi bi-box-arrow-up-right"></i> View Live Site
                </a>
            </nav>

            <div class="mt-auto pt-4 border-top border-secondary">
                <div class="d-flex align-items-center mb-3 text-white-50 px-2">
                    <i class="bi bi-person-circle fs-4 me-2"></i>
                    <div>
                        <div class="fw-bold text-white"><%= user.username %></div>
                        <small style="font-size: 0.8rem;"><%= user.role.toUpperCase() %></small>
                    </div>
                </div>
                <a href="/logout" class="btn btn-outline-danger w-100 btn-sm">
                    <i class="bi bi-box-arrow-left"></i> Logout
                </a>
            </div>
        </aside>

        <!-- Main Admin Content -->
        <main class="admin-content fade-in">
            <div class="admin-header">
                <div>
                    <h2 class="fw-bold text-dark">Dashboard Overview</h2>
                    <p class="text-secondary mb-0">Manage your coding documentation and settings.</p>
                </div>
                <button onclick="window.location.reload()" class="btn btn-light rounded-circle shadow-sm" title="Refresh">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
            </div>

            <% if(success_msg.length > 0) { %>
                <div class="alert alert-success border-0 shadow-sm rounded-3 mb-4 fade-in"><i class="bi bi-check-circle-fill me-2"></i> <%= success_msg %></div>
            <% } %>
            <% if(error_msg.length > 0) { %>
                <div class="alert alert-danger border-0 shadow-sm rounded-3 mb-4 fade-in"><i class="bi bi-exclamation-triangle-fill me-2"></i> <%= error_msg %></div>
            <% } %>

            <!-- Stats Cards with Admin Layout -->
            <div class="row g-4 mb-5">
                <div class="col-md-4">
                    <div class="admin-card p-4 d-flex align-items-center">
                        <div class="admin-stats-icon bg-primary bg-opacity-10 text-primary me-3">
                            <i class="bi bi-file-text"></i>
                        </div>
                        <div>
                            <h3 class="fw-bold m-0"><%= notes.length %></h3>
                            <span class="text-muted">Total Notes</span>
                        </div>
                    </div>
                </div>
                
                <% if (user.role === 'superadmin') { %>
                <div class="col-md-4">
                    <div class="admin-card p-4 d-flex align-items-center">
                        <div class="admin-stats-icon bg-success bg-opacity-10 text-success me-3">
                            <i class="bi bi-people"></i>
                        </div>
                        <div>
                            <h3 class="fw-bold m-0"><%= users.length %></h3>
                            <span class="text-muted">Admins</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="admin-card p-4 d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="fw-bold m-0 mb-1">Registration</h5>
                            <span class="badge <%= registrationEnabled ? 'bg-success' : 'bg-danger' %> rounded-pill">
                                <%= registrationEnabled ? 'OPEN' : 'LOCKED' %>
                            </span>
                        </div>
                        <form action="/toggle-registration" method="POST">
                            <button class="btn btn-sm btn-outline-dark rounded-pill">Toggle</button>
                        </form>
                    </div>
                </div>
                <% } %>
            </div>

            <!-- Notes List -->
            <div class="d-flex justify-content-between align-items-end mb-3">
                <h4 class="fw-bold m-0">Recent Notes</h4>
                <a href="/add-note" class="btn btn-primary rounded-pill px-4 shadow-sm">
                    <i class="bi bi-plus-lg"></i> Create New
                </a>
            </div>

            <div class="table-responsive">
                <table class="table admin-table text-nowrap">
                    <thead>
                        <tr>
                            <th class="text-secondary fw-normal border-0 ps-4">Title</th>
                            <th class="text-secondary fw-normal border-0">Category</th>
                            <th class="text-secondary fw-normal border-0">Created At</th>
                            <th class="text-secondary fw-normal border-0 text-end pe-4">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (notes.length > 0) { %>
                            <% notes.forEach((note, index) => { %>
                                <tr style="animation: fadeIn 0.3s ease-out forwards; animation-delay: <%= index * 0.05 %>s; opacity: 0;">
                                    <td class="fw-bold text-dark ps-4"><%= note.title %></td>
                                    <td><span class="badge bg-light text-dark border"><%= note.category %></span></td>
                                    <td class="text-secondary"><%= note.createdAt.toLocaleDateString() %></td>
                                    <td class="text-end pe-4">
                                        <a href="/note/<%= note._id %>" class="btn btn-sm btn-light text-primary rounded-circle me-1" title="View"><i class="bi bi-eye"></i></a>
                                        <form action="/note/<%= note._id %>?_method=DELETE" method="POST" class="d-inline">
                                            <button type="submit" class="btn btn-light btn-sm text-danger rounded-circle" onclick="return confirm('Delete this note?')" title="Delete"><i class="bi bi-trash"></i></button>
                                        </form>
                                    </td>
                                </tr>
                            <% }) %>
                        <% } else { %>
                            <tr>
                                <td colspan="4" class="text-center py-5 text-muted bg-white rounded-3">
                                    <i class="bi bi-inbox fs-1 d-block mb-3 opacity-25"></i>
                                    No notes found. Create your first one!
                                </td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>

        </main>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
